# AI Agent æ‹¡å¼µä»•æ§˜æ›¸

## æ¦‚è¦

æ±ç”¨ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã®ãŸã‚ã®AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚
æ‹¡å¼µæ€§ã¨ã‚·ãƒ³ãƒ—ãƒ«ã•ã‚’é‡è¦–ã—ã€æ®µéšçš„ã«æ©Ÿèƒ½ã‚’è¿½åŠ ã§ãã‚‹è¨­è¨ˆã€‚

### è¨­è¨ˆåŸå‰‡

1. **ã‚¿ã‚¹ã‚¯éä¾å­˜ã®åŸºç›¤å±¤**: Context Management, History, Toolsã¯ç‰¹å®šã‚¿ã‚¹ã‚¯ã«ä¾å­˜ã—ãªã„
2. **ãƒ—ãƒ©ã‚¬ãƒ–ãƒ«ãªã‚¿ã‚¹ã‚¯å±¤**: å„ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ï¼ˆMulmoScriptç”Ÿæˆã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆç­‰ï¼‰ã¯ç‹¬ç«‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦å®Ÿè£…
3. **ã‚·ãƒ³ãƒ—ãƒ«å„ªå…ˆ**: å¿…è¦ã«ãªã‚‹ã¾ã§æ©Ÿèƒ½ã‚’è¿½åŠ ã—ãªã„

### ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ä¾‹

- **MulmoScriptç”Ÿæˆ**: ãƒãƒ«ãƒãƒ¡ãƒ‡ã‚£ã‚¢ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ç”Ÿæˆãƒ»ç·¨é›†ï¼ˆå®Ÿè£…ä¾‹ï¼‰
- **ã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°**: ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰æ“ä½œ
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ**: æŠ€è¡“æ–‡æ›¸ãƒ»ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- **ãƒ‡ãƒ¼ã‚¿åˆ†æ**: æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ãƒ»åˆ†æ

## ç¾åœ¨ã®æ§‹æˆ

```
src/
â”œâ”€â”€ agent.ts          # ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
â”œâ”€â”€ context/          # ãƒ¢ãƒ¼ãƒ‰ãƒ»å±¥æ­´ç®¡ç†
â”œâ”€â”€ history/          # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´
â”œâ”€â”€ llm/              # LLMãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æŠ½è±¡åŒ–
â””â”€â”€ tools/            # ãƒ„ãƒ¼ãƒ«å®šç¾©ãƒ»å®Ÿè¡Œ
```

---

## MulmoScriptå¯¾å¿œ

### MulmoScriptã¨ã¯

ãƒãƒ«ãƒãƒ¡ãƒ‡ã‚£ã‚¢ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³/ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆç”Ÿæˆç”¨ã®JSONã‚¹ã‚­ãƒ¼ãƒã€‚

- **beats**: å€‹åˆ¥ã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆè©±è€…ã€ãƒ†ã‚­ã‚¹ãƒˆã€ç”»åƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€éŸ³å£°ãªã©ï¼‰
- **presentationStyle**: ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã€éŸ³å£°è¨­å®šã€ã‚¹ã‚¿ã‚¤ãƒ«
- Zodã«ã‚ˆã‚‹ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼

**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**: `mulmocast` (npm)
- ã‚¹ã‚­ãƒ¼ãƒ: `mulmoScriptSchema`, `mulmoBeatSchema`
- å‚ç…§: https://github.com/receptron/mulmocast-cli

### ç”Ÿæˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1: æƒ…å ±åé›†ï¼ˆå¯¾è©±ï¼‰                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ URLå–å¾— â†’ Webãƒšãƒ¼ã‚¸å†…å®¹ã®å–å¾—                                  â”‚
â”‚  â€¢ ã‚³ãƒ”ãƒšå—ä»˜ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›                          â”‚
â”‚  â€¢ å¯¾è©± â†’ å†…å®¹ã®ç¢ºèªãƒ»è©³ç´°ãƒ’ã‚¢ãƒªãƒ³ã‚°                               â”‚
â”‚  â€¢ å‡ºåŠ›: å‚ç…§æ–‡æ›¸ãƒªã‚¹ãƒˆ + ãƒ¦ãƒ¼ã‚¶ãƒ¼æ„å›³ã®ç†è§£                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 2: Beatsç”Ÿæˆ                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ åé›†æƒ…å ±ã‹ã‚‰beatsã®åŸºæœ¬æ§‹é€ ã‚’ç”Ÿæˆ                               â”‚
â”‚  â€¢ å¯¾è©±ã§ã‚¹ã‚¿ã‚¤ãƒ«æ±ºå®š:                                            â”‚
â”‚    - ç”»åƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å«ã‚ã‚‹ã‹ï¼Ÿ                                    â”‚
â”‚    - å‹•ç”»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å«ã‚ã‚‹ã‹ï¼Ÿ                                    â”‚
â”‚    - è©±è€…æ§‹æˆã¯ï¼Ÿ                                                 â”‚
â”‚  â€¢ å‡ºåŠ›: beatsé…åˆ—ï¼ˆspeaker, text, imagePromptç­‰ï¼‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 3: Styleé©ç”¨ãƒ»å®Œæˆ                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ presentationStyleã®ãƒãƒ¼ã‚¸                                      â”‚
â”‚  â€¢ ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼æƒ…å ±ã®æŒ¿å…¥ï¼ˆinsertSpeakersï¼‰                          â”‚
â”‚  â€¢ Beat IDã®ä»˜ä¸                                                  â”‚
â”‚  â€¢ Zodã‚¹ã‚­ãƒ¼ãƒã«ã‚ˆã‚‹æ¤œè¨¼                                          â”‚
â”‚  â€¢ å‡ºåŠ›: å®Œæˆã—ãŸMulmoScript                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

å‚ç…§å®Ÿè£…: [mulmocast-app/chat.vue - runé–¢æ•°](https://github.com/receptron/mulmocast-app/blob/main/src/renderer/pages/project/chat.vue)

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å±¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Task Layer (ã‚¿ã‚¹ã‚¯å±¤) - ã‚¿ã‚¹ã‚¯å›ºæœ‰ã®å®Ÿè£…                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ MulmoScriptç”Ÿæˆ (src/mulmo/)                                 â”‚
â”‚  â€¢ [å°†æ¥] ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆã€etc.                       â”‚
â”‚  â€¢ å„ã‚¿ã‚¹ã‚¯ã¯ç‹¬ç«‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦å®Ÿè£…                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†‘ uses
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Foundation Layer (åŸºç›¤å±¤) - ã‚¿ã‚¹ã‚¯éä¾å­˜                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â€¢ Context Management: å‚ç…§æ–‡æ›¸ã€å±¥æ­´ãƒ•ã‚£ãƒ«ã‚¿ã€ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†         â”‚
â”‚  â€¢ History: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ã€ãƒ©ãƒ™ãƒ«ç®¡ç†                             â”‚
â”‚  â€¢ Tools: ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã€Webå–å¾—ã€è¨ˆç®—ç­‰                           â”‚
â”‚  â€¢ LLM: ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼æŠ½è±¡åŒ–                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ‹¡å¼µè¨ˆç”»

### Phase 0: ãƒ¢ãƒ¼ãƒ‰ãƒ»ã‚¿ã‚¹ã‚¯ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ï¼ˆåŸºç›¤å±¤ï¼‰

ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆã€ã‚¿ã‚¹ã‚¯ã®ä¸­æ–­ãƒ»å†é–‹ã‚’ç®¡ç†ã™ã‚‹ä¸­æ ¸æ©Ÿèƒ½ã€‚

#### 0.1 ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¿ãƒƒã‚¯
```
[conversation] â† ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ¼ãƒ‰ï¼ˆå¸¸ã«æœ€ä¸‹å±¤ï¼‰
     â†‘ push/pop
[mulmo:collecting] â† ã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ‰
     â†‘ push/pop
[conversation] â† ä¸€æ™‚çš„ãªä¼šè©±ï¼ˆã€Œä»Šä½•æ™‚ï¼Ÿã€ãªã©ï¼‰
```

- ãƒ¢ãƒ¼ãƒ‰ã¯ã‚¹ã‚¿ãƒƒã‚¯æ§‹é€ ã§ç®¡ç†
- ä¸€æ™‚çš„ãªãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆå¾Œã€è‡ªå‹•çš„ã«å‰ã®ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚Œã‚‹
- ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ã¯ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ¼ãƒ‰ã¾ã§æˆ»ã‚‹

#### 0.2 ã‚¿ã‚¹ã‚¯ã‚»ãƒƒã‚·ãƒ§ãƒ³
- é•·æ™‚é–“ã‚¿ã‚¹ã‚¯ï¼ˆMulmoScriptç”Ÿæˆç­‰ï¼‰ã¯ã€Œã‚»ãƒƒã‚·ãƒ§ãƒ³ã€ã¨ã—ã¦ç®¡ç†
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ä¸­æ–­ï¼ˆsuspendï¼‰ãƒ»å†é–‹ï¼ˆresumeï¼‰å¯èƒ½
- è¤‡æ•°ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¿æŒå¯èƒ½ï¼ˆ1ã¤ã®ã¿ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã‚¿ã‚¹ã‚¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  [idle] â”€â”€startâ”€â”€> [active] â”€â”€completeâ”€â”€> [completed]           â”‚
â”‚                       â”‚                                         â”‚
â”‚                    suspend                                      â”‚
â”‚                       â†“                                         â”‚
â”‚                  [suspended] â”€â”€resumeâ”€â”€> [active]               â”‚
â”‚                       â”‚                                         â”‚
â”‚                    discard                                      â”‚
â”‚                       â†“                                         â”‚
â”‚                  [discarded]                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 0.3 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå†…ã®çŠ¶æ…‹ç®¡ç†

```typescript
interface AgentContext {
  // ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¿ãƒƒã‚¯
  modeStack: ModeStackEntry[];

  // ã‚¿ã‚¹ã‚¯ã‚»ãƒƒã‚·ãƒ§ãƒ³
  sessions: Map<string, TaskSession>;
  activeSessionId: string | null;

  // å…±æœ‰ãƒªã‚½ãƒ¼ã‚¹ï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰ãƒ»ã‚¿ã‚¹ã‚¯ã§å…±æœ‰ï¼‰
  history: ConversationHistory;
  references: ReferenceDocument[];
}

interface ModeStackEntry {
  mode: AgentMode;
  enteredAt: Date;
  sessionId?: string;  // ã“ã®ãƒ¢ãƒ¼ãƒ‰ã«ç´ã¥ãã‚¿ã‚¹ã‚¯ã‚»ãƒƒã‚·ãƒ§ãƒ³
}

interface TaskSession {
  id: string;
  taskType: string;           // "mulmo", "codegen", etc.
  status: "active" | "suspended" | "completed" | "discarded";
  state: unknown;             // ã‚¿ã‚¹ã‚¯å›ºæœ‰ã®çŠ¶æ…‹
  createdAt: Date;
  updatedAt: Date;
  historySnapshot?: number;   // ä¸­æ–­æ™‚ã®å±¥æ­´ä½ç½®
}
```

#### 0.4 ãƒ¢ãƒ¼ãƒ‰é·ç§»ãƒ«ãƒ¼ãƒ«

| ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ | çµæœ |
|-------------|-----------|------|
| conversation | ã‚¿ã‚¹ã‚¯é–‹å§‹ | ã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚’pushã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ |
| task:* | ä¸€æ™‚çš„ãªè³ªå• | conversationã‚’push |
| task:* (pushed conversation) | å›ç­”å®Œäº† | popã€ã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚‹ |
| task:* | ã€Œä¸­æ–­ã—ã¦ã€ | ã‚»ãƒƒã‚·ãƒ§ãƒ³suspendã€ãƒ™ãƒ¼ã‚¹ã¾ã§pop |
| conversation | ã€Œç¶šãã‚„ã£ã¦ã€ | ã‚»ãƒƒã‚·ãƒ§ãƒ³resumeã€ã‚¿ã‚¹ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚’push |
| task:* | ã‚¿ã‚¹ã‚¯å®Œäº† | ã‚»ãƒƒã‚·ãƒ§ãƒ³completeã€ãƒ™ãƒ¼ã‚¹ã¾ã§pop |

#### 0.5 çŠ¶æ…‹è¡¨ç¤ºï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼‰

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã¤ã§ã‚‚ç¾åœ¨ã®çŠ¶æ…‹ã‚’æŠŠæ¡ã§ãã‚‹ã‚ˆã†ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºæ©Ÿèƒ½ã‚’æä¾›ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ ç¾åœ¨: MulmoScriptç”Ÿæˆ > æƒ…å ±åé›†ä¸­                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ¯ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ã‚¹ã‚¯:                                             â”‚
â”‚     [mulmo-001] MulmoScriptç”Ÿæˆ - Phase 1/3 (URL: 2ä»¶åé›†æ¸ˆã¿)   â”‚
â”‚                                                                 â”‚
â”‚  ğŸ’¤ ä¸­æ–­ä¸­ã®ã‚¿ã‚¹ã‚¯:                                               â”‚
â”‚     [code-002] ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ - ä»•æ§˜ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡                       â”‚
â”‚     [doc-003] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ - 50%å®Œäº†                          â”‚
â”‚                                                                 â”‚
â”‚  ğŸ’¬ ã€Œç¶šãã‚„ã£ã¦ã€ã€Œã‚¿ã‚¹ã‚¯ä¸€è¦§ã€ã€Œ[ID]ã‚’å†é–‹ã€ã§æ“ä½œã§ãã¾ã™          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 0.6 å…·ä½“çš„ãªã‚·ãƒŠãƒªã‚ªä¾‹

```
User: MulmoScriptã‚’ä½œã£ã¦
Agent: [ã‚»ãƒƒã‚·ãƒ§ãƒ³ mulmo-001 é–‹å§‹, mulmo:collecting ãƒ¢ãƒ¼ãƒ‰ã¸]
       MulmoScriptã‚’ä½œæˆã—ã¾ã™ã€‚ã¾ãšURLã‚’æ•™ãˆã¦ãã ã•ã„ã€‚

User: https://example.com/article
Agent: [URLå–å¾—ãƒ»å‚ç…§æ–‡æ›¸è¿½åŠ ]
       è¨˜äº‹ã‚’å–å¾—ã—ã¾ã—ãŸã€‚ä»–ã«ã‚‚ã‚ã‚Šã¾ã™ã‹ï¼Ÿ

User: ä»Šä½•æ™‚ï¼Ÿ
Agent: [conversation ãƒ¢ãƒ¼ãƒ‰ã‚’ä¸€æ™‚çš„ã«push]
       ç¾åœ¨15:30ã§ã™ã€‚
       [pop, mulmo:collecting ã«æˆ»ã‚‹]
       MulmoScriptã®ä½œæˆã‚’ç¶šã‘ã¾ã™ã€‚ä»–ã«URLã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ

User: ä¸€æ—¦ä¸­æ–­ã—ã¦
Agent: [mulmo-001 ã‚’ suspend, conversation ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã‚‹]
       MulmoScriptä½œæˆã‚’ä¸­æ–­ã—ã¾ã—ãŸã€‚Phase 1ï¼ˆæƒ…å ±åé›†ï¼‰ã®é€”ä¸­ã§ã™ã€‚
       ã€Œç¶šãã‚„ã£ã¦ã€ã§å†é–‹ã§ãã¾ã™ã€‚

User: åˆ¥ã®ã‚¿ã‚¹ã‚¯å§‹ã‚ã¦ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
Agent: [ã‚»ãƒƒã‚·ãƒ§ãƒ³ code-002 é–‹å§‹, codegen ãƒ¢ãƒ¼ãƒ‰ã¸]
       ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã™ã€‚ä»•æ§˜ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚

User: ã‚¿ã‚¹ã‚¯ä¸€è¦§è¦‹ã›ã¦
Agent: ğŸ¯ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–: [code-002] ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
       ğŸ’¤ ä¸­æ–­ä¸­: [mulmo-001] MulmoScriptç”Ÿæˆ (Phase 1/3)

User: mulmo-001ã‚’å†é–‹
Agent: [code-002 ã‚’ suspend, mulmo-001 ã‚’ resume]
       MulmoScriptä½œæˆã‚’å†é–‹ã—ã¾ã™ã€‚URLåé›†ã®ç¶šãã‹ã‚‰ã§ã™ã€‚
```

---

### Phase 1: Context Managementï¼ˆåŸºç›¤å±¤ï¼‰

**æ³¨æ„**: ã“ã®å±¤ã¯ã‚¿ã‚¹ã‚¯éä¾å­˜ã€‚ã‚ã‚‰ã‚†ã‚‹ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ã§å†åˆ©ç”¨å¯èƒ½ãªæ±ç”¨æ©Ÿèƒ½ã‚’æä¾›ã€‚

#### 1.1 å‚ç…§æ–‡æ›¸ç®¡ç†
- URL/ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ã®æ–‡æ›¸è¿½åŠ 
- å„ªå…ˆåº¦ãƒ»é–¢é€£åº¦ã«ã‚ˆã‚‹é¸åˆ¥
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä»˜ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†

#### 1.2 å±¥æ­´ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- ãƒ©ãƒ™ãƒ«/ã‚¿ã‚°ã«ã‚ˆã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é¸åˆ¥
- Phaseåˆ¥ã®é–¢é€£å±¥æ­´ã®ã¿ã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å«ã‚ã‚‹
- é‡è¦åº¦ã«åŸºã¥ãå„ªå…ˆé †ä½ä»˜ã‘

#### 1.3 ãƒˆãƒ¼ã‚¯ãƒ³ç¯€ç´„
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ç®¡ç†
- å¤ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¦ç´„ãƒ»åœ§ç¸®
- ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²ã«ã‚ˆã‚‹å¤§è¦æ¨¡å…¥åŠ›å¯¾å¿œ

#### 1.4 ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†
- ç”Ÿæˆãƒ•ã‚§ãƒ¼ã‚ºã®çŠ¶æ…‹ä¿æŒï¼ˆPhase 1/2/3ï¼‰
- ä¸­é–“æˆæœç‰©ã®ä¿å­˜ï¼ˆå‚ç…§æ–‡æ›¸ã€beatsç­‰ï¼‰
- ã‚»ãƒƒã‚·ãƒ§ãƒ³å†é–‹æ©Ÿèƒ½

### Phase 2: MulmoScriptç”Ÿæˆï¼ˆã‚¿ã‚¹ã‚¯å±¤ - å®Ÿè£…ä¾‹ï¼‰

**æ³¨æ„**: ã“ã‚Œã¯ã‚¿ã‚¹ã‚¯å±¤ã®å®Ÿè£…ä¾‹ã€‚åŒæ§˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ä»–ã®ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ã‚‚è¿½åŠ å¯èƒ½ã€‚

#### 2.1 ã‚¹ã‚­ãƒ¼ãƒçµ±åˆ
- `mulmocast`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‹ã‚‰ã‚¹ã‚­ãƒ¼ãƒã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- `mulmoScriptSchema`, `mulmoBeatSchema`ã®åˆ©ç”¨

#### 2.2 æƒ…å ±åé›†ãƒ„ãƒ¼ãƒ«
- `web_fetch`: URLå†…å®¹ã®å–å¾—
- `add_reference`: å‚ç…§æ–‡æ›¸ã®è¿½åŠ 
- å¯¾è©±ã«ã‚ˆã‚‹æ„å›³ç¢ºèª

#### 2.3 Beatsç”Ÿæˆ
- å‚ç…§æ–‡æ›¸ã‹ã‚‰beatsé…åˆ—ã‚’ç”Ÿæˆ
- ã‚¹ã‚¿ã‚¤ãƒ«é¸æŠã®å¯¾è©±ã‚µãƒãƒ¼ãƒˆ
- `imagePrompt`, `moviePrompt`ã®æ¡ä»¶ä»˜ãç”Ÿæˆ

#### 2.4 Styleé©ç”¨ãƒ»å®Œæˆ
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰presentationStyleã‚’ãƒãƒ¼ã‚¸
- ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼æƒ…å ±ã®æŒ¿å…¥
- æ¤œè¨¼ã¨å‡ºåŠ›

### Phase 3: å¤–éƒ¨ãƒ„ãƒ¼ãƒ«é€£æº

#### 3.1 Webå–å¾—
- `web_fetch` ãƒ„ãƒ¼ãƒ«
- HTMLâ†’Markdownå¤‰æ›
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æŠ½å‡º

#### 3.2 ã‚·ã‚§ãƒ«ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- `execute_command` ãƒ„ãƒ¼ãƒ«
- ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹/è¨±å¯ãƒªã‚¹ãƒˆ

### Phase 4: ãƒ¡ãƒ¢ãƒªãƒ»æ°¸ç¶šåŒ–

#### 4.1 ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´
- ä¼šè©±å±¥æ­´ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜/å¾©å…ƒ
- ç”Ÿæˆé€”ä¸­ã®MulmoScriptä¿å­˜

#### 4.2 å­¦ç¿’ãƒ¡ãƒ¢ãƒª
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å¥½ã¿ã®ã‚¹ã‚¿ã‚¤ãƒ«è¨˜æ†¶
- éå»ã®æ±ºå®šãƒ‘ã‚¿ãƒ¼ãƒ³

### Phase 5: ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

#### 5.1 ã‚¿ã‚¹ã‚¯å§”è­²å‹
- Phaseåˆ¥ã®å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
- æƒ…å ±åé›†Agent â†’ Beatsç”ŸæˆAgent â†’ Styleé©ç”¨Agent

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆäºˆå®šï¼‰

```
src/
â”œâ”€â”€ agent.ts
â”œâ”€â”€ context/                  # åŸºç›¤å±¤: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ types.ts
â”‚   â”œâ”€â”€ agent-context.ts
â”‚   â”œâ”€â”€ mode-manager.ts      # NEW: ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¿ãƒƒã‚¯ç®¡ç†
â”‚   â”œâ”€â”€ session-manager.ts   # NEW: ã‚¿ã‚¹ã‚¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â”œâ”€â”€ context-manager.ts   # NEW: çµ±åˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†
â”‚   â””â”€â”€ references.ts        # NEW: å‚ç…§æ–‡æ›¸ç®¡ç†
â”œâ”€â”€ history/                  # åŸºç›¤å±¤: å±¥æ­´ç®¡ç†
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ types.ts
â”‚   â”œâ”€â”€ message-history.ts
â”‚   â””â”€â”€ filter.ts            # NEW: å±¥æ­´ãƒ•ã‚£ãƒ«ã‚¿
â”œâ”€â”€ llm/                      # åŸºç›¤å±¤: LLMæŠ½è±¡åŒ–
â”œâ”€â”€ tools/                    # åŸºç›¤å±¤: ãƒ„ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ builtin/
â”‚   â”‚   â”œâ”€â”€ file.ts
â”‚   â”‚   â”œâ”€â”€ web.ts           # NEW: web_fetch
â”‚   â”‚   â””â”€â”€ shell.ts         # NEW: execute_command
â”‚   â””â”€â”€ mcp/                  # FUTURE
â”œâ”€â”€ memory/                   # åŸºç›¤å±¤: æ°¸ç¶šåŒ–
â”‚   â”œâ”€â”€ session.ts           # ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜/å¾©å…ƒ
â”‚   â””â”€â”€ storage.ts
â”œâ”€â”€ tasks/                    # ã‚¿ã‚¹ã‚¯å±¤: å…±é€šåŸºç›¤
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ types.ts             # TaskHandlerç­‰ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â””â”€â”€ registry.ts          # ã‚¿ã‚¹ã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç™»éŒ²
â””â”€â”€ mulmo/                    # ã‚¿ã‚¹ã‚¯å±¤: MulmoScript
    â”œâ”€â”€ index.ts
    â”œâ”€â”€ types.ts              # mulmocastã‹ã‚‰re-export
    â”œâ”€â”€ handler.ts            # MulmoTaskHandlerå®Ÿè£…
    â”œâ”€â”€ generator.ts          # Beatsç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯
    â”œâ”€â”€ styler.ts             # Styleé©ç”¨ãƒ­ã‚¸ãƒƒã‚¯
    â””â”€â”€ templates/            # ã‚¹ã‚¿ã‚¤ãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```

### ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆ

#### åŸºç›¤å±¤ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

ä»¥ä¸‹ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ã‚¿ã‚¹ã‚¯éä¾å­˜ã€‚ã©ã®ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ã§ã‚‚å…±é€šã—ã¦åˆ©ç”¨å¯èƒ½ã€‚

#### Mode & Session Manager
```typescript
interface ModeManager {
  // ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¿ãƒƒã‚¯æ“ä½œ
  pushMode(mode: AgentMode, sessionId?: string): void;
  popMode(): ModeStackEntry | undefined;
  getCurrentMode(): AgentMode;
  getModeStack(): readonly ModeStackEntry[];

  // ã‚¿ã‚¹ã‚¯ã‚»ãƒƒã‚·ãƒ§ãƒ³æ“ä½œ
  startSession(taskType: string, initialState?: unknown): TaskSession;
  suspendSession(sessionId: string): void;
  resumeSession(sessionId: string): void;
  completeSession(sessionId: string): void;
  discardSession(sessionId: string): void;

  // ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹
  getActiveSession(): TaskSession | null;
  getSuspendedSessions(): TaskSession[];
  getAllSessions(): TaskSession[];
  getSession(sessionId: string): TaskSession | undefined;

  // ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ã®æ›´æ–°
  updateSessionState(sessionId: string, state: unknown): void;
}

// è¡¨ç¤ºç”¨ï¼šç¾åœ¨ã®çŠ¶æ…‹ã‚µãƒãƒªãƒ¼
interface ContextStatus {
  currentMode: AgentMode;
  modeStackDepth: number;
  activeTask: { id: string; type: string; status: string } | null;
  suspendedTasks: Array<{ id: string; type: string; summary: string }>;
}
```

#### Context Manager
```typescript
interface ContextManager {
  // ãƒ¢ãƒ¼ãƒ‰ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
  mode: ModeManager;

  // å‚ç…§æ–‡æ›¸
  addReference(doc: ReferenceDocument): void;
  getReferences(): ReferenceDocument[];
  clearReferences(): void;

  // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ§‹ç¯‰
  buildContext(options: ContextBuildOptions): BaseMessage[];

  // çŠ¶æ…‹ã‚µãƒãƒªãƒ¼ï¼ˆè¡¨ç¤ºç”¨ï¼‰
  getStatus(): ContextStatus;

  // ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
  estimateTokens(content: string): number;
  summarize(messages: LabeledMessage[], maxTokens: number): LabeledMessage[];
}

interface ReferenceDocument {
  id: string;
  source: string;           // URL or "user_input"
  content: string;
  title?: string;
  priority: number;         // 1-10
}

interface ContextBuildOptions {
  maxTokens: number;
  includeLabels?: MessageLabel[];
  excludeLabels?: MessageLabel[];
  includeReferences?: boolean;
}
```

#### ã‚¿ã‚¹ã‚¯å±¤ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆæ‹¡å¼µãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

ã‚¿ã‚¹ã‚¯å±¤ã¯ä»¥ä¸‹ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å®Ÿè£…ã€‚æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ã‚’è¿½åŠ ã™ã‚‹éš›ã‚‚ã“ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¾“ã†ã€‚

```typescript
// æ±ç”¨ã‚¿ã‚¹ã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
interface TaskHandler<TInput, TOutput, TState> {
  // ã‚¿ã‚¹ã‚¯å
  readonly name: string;

  // ç¾åœ¨ã®çŠ¶æ…‹ã‚’å–å¾—
  getState(): TState;

  // ã‚¿ã‚¹ã‚¯å®Ÿè¡Œï¼ˆçŠ¶æ…‹ã‚’æ›´æ–°ã—ãªãŒã‚‰æ®µéšçš„ã«å®Ÿè¡Œï¼‰
  execute(input: TInput, context: ContextManager): Promise<TOutput>;

  // ä¸­é–“çŠ¶æ…‹ã‹ã‚‰å†é–‹
  resume(state: TState, context: ContextManager): Promise<TOutput>;

  // æ¤œè¨¼
  validate(output: TOutput): boolean;
}

// ä½¿ç”¨ä¾‹: å„ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—ã¯ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…
// - MulmoScriptHandler: TInput=å‚ç…§æ–‡æ›¸, TOutput=MulmoScript, TState=MulmoGenerationState
// - CodeGeneratorHandler: TInput=ä»•æ§˜æ›¸, TOutput=ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰, TState=CodeGenState
// - DocumentHandler: TInput=å…¥åŠ›ãƒ‡ãƒ¼ã‚¿, TOutput=ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ, TState=DocGenState
```

#### MulmoScript Generatorï¼ˆã‚¿ã‚¹ã‚¯å±¤å®Ÿè£…ä¾‹ï¼‰
```typescript
import { MulmoScript, MulmoBeat, MulmoPresentationStyle } from 'mulmocast';

interface MulmoGenerator {
  // Phase 2: Beatsç”Ÿæˆ
  generateBeats(
    references: ReferenceDocument[],
    options: BeatsOptions
  ): Promise<MulmoBeat[]>;

  // Phase 3: Styleé©ç”¨ãƒ»å®Œæˆ
  applyStyle(
    beats: MulmoBeat[],
    style: Partial<MulmoPresentationStyle>
  ): MulmoScript;

  // æ¤œè¨¼
  validate(script: unknown): MulmoScript;
}

interface BeatsOptions {
  includeImagePrompts: boolean;
  includeMoviePrompts: boolean;
  speakers: SpeakerConfig[];
  language: string;
}
```

#### Generation State
```typescript
interface MulmoGenerationState {
  phase: 'collecting' | 'generating_beats' | 'applying_style' | 'completed';
  references: ReferenceDocument[];
  beats?: MulmoBeat[];
  style?: Partial<MulmoPresentationStyle>;
  script?: MulmoScript;
}
```

---

## å®Ÿè£…å„ªå…ˆé †ä½

### åŸºç›¤å±¤ï¼ˆFoundation Layerï¼‰- å…ˆã«å®Ÿè£…

#### Step 1: ãƒ¢ãƒ¼ãƒ‰ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† â­æœ€é‡è¦
1. **ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¿ãƒƒã‚¯** - push/popã€ç¾åœ¨ãƒ¢ãƒ¼ãƒ‰å–å¾—
2. **ã‚¿ã‚¹ã‚¯ã‚»ãƒƒã‚·ãƒ§ãƒ³** - é–‹å§‹/ä¸­æ–­/å†é–‹/å®Œäº†
3. **çŠ¶æ…‹è¡¨ç¤º** - ContextStatusã€ã‚¿ã‚¹ã‚¯ä¸€è¦§

#### Step 2: Context Management
1. **å‚ç…§æ–‡æ›¸ç®¡ç†** - ReferenceDocumentè¿½åŠ ãƒ»å–å¾—
2. **ãƒˆãƒ¼ã‚¯ãƒ³æ¨å®š** - ç°¡æ˜“ãƒˆãƒ¼ã‚¯ãƒ³ã‚«ã‚¦ãƒ³ãƒˆ
3. **å±¥æ­´ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°** - ãƒ©ãƒ™ãƒ«ãƒ™ãƒ¼ã‚¹ã®é¸åˆ¥

#### Step 3: å¤–éƒ¨ãƒ„ãƒ¼ãƒ«
1. **web_fetch** - URLå†…å®¹ã®å–å¾—ãƒ»Markdownå¤‰æ›
2. ï¼ˆå°†æ¥ï¼‰**execute_command** - ã‚·ã‚§ãƒ«ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ

#### Step 4: ãƒ¡ãƒ¢ãƒªãƒ»æ°¸ç¶šåŒ–
1. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜** - å±¥æ­´ãƒ»çŠ¶æ…‹ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æ°¸ç¶šåŒ–
2. **ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒ** - å†èµ·å‹•å¾Œã‚‚ä¸­æ–­ã‚¿ã‚¹ã‚¯ã‚’å¾©å…ƒå¯èƒ½

---

### ã‚¿ã‚¹ã‚¯å±¤ï¼ˆTask Layerï¼‰- åŸºç›¤å±¤ã®ä¸Šã«å®Ÿè£…

#### Step 5: MulmoScriptå¯¾å¿œï¼ˆå®Ÿè£…ä¾‹ï¼‰
1. **ã‚¹ã‚­ãƒ¼ãƒçµ±åˆ** - mulmocastãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å°å…¥
2. **Beatsç”Ÿæˆ** - å‚ç…§æ–‡æ›¸ã‹ã‚‰beatsç”Ÿæˆ
3. **Styleé©ç”¨** - presentationStyleãƒãƒ¼ã‚¸ãƒ»å®Œæˆ
4. **MulmoGenerationState** - MulmoScriptå›ºæœ‰ã®çŠ¶æ…‹ç®¡ç†

#### [å°†æ¥] ä»–ã®ã‚¿ã‚¹ã‚¯ã‚¿ã‚¤ãƒ—
- ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¿ã‚¹ã‚¯
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆã‚¿ã‚¹ã‚¯
- ãƒ‡ãƒ¼ã‚¿åˆ†æã‚¿ã‚¹ã‚¯

---

## ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```json
{
  "dependencies": {
    "mulmocast": "^2.1.15"
  }
}
```

---

## è¨­è¨ˆåŸå‰‡

1. **ã‚·ãƒ³ãƒ—ãƒ«ã•å„ªå…ˆ**: å¿…è¦ã«ãªã‚‹ã¾ã§æ©Ÿèƒ½ã‚’è¿½åŠ ã—ãªã„
2. **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å…ˆè¡Œ**: å®Ÿè£…å‰ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å›ºã‚ã‚‹
3. **æ®µéšçš„æ‹¡å¼µ**: å°ã•ãå§‹ã‚ã¦å¾ã€…ã«æ‹¡å¼µ
4. **å¾Œæ–¹äº’æ›æ€§**: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã‚’å£Šã•ãªã„
5. **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£**: ãƒ¢ãƒƒã‚¯å¯èƒ½ãªè¨­è¨ˆ
6. **å±¤ã®åˆ†é›¢**: åŸºç›¤å±¤ã¯ã‚¿ã‚¹ã‚¯å±¤ã«ä¾å­˜ã—ãªã„ï¼ˆä¾å­˜ã¯ä¸Šã‹ã‚‰ä¸‹ã¸ã®ä¸€æ–¹å‘ï¼‰
7. **ã‚¿ã‚¹ã‚¯éä¾å­˜æ€§**: åŸºç›¤å±¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ç‰¹å®šã‚¿ã‚¹ã‚¯ã®æ¦‚å¿µã‚’å«ã‚ãªã„
